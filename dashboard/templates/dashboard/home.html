<!-- apps/dashboard/templates/dashboard/home.html -->
{% extends 'base.html' %}

{% block title %}Tableau de bord - EpreuvesPro B√©nin{% endblock %}

{% block content %}
<div class="dashboard-container">
    
    <!-- Header de bienvenue -->
    <div class="welcome-header">
        <div class="welcome-text">
            <h1>Bonjour {{ user.get_display_name }} ! üëã</h1>
            <p>Pr√™t pour vos r√©visions ? Voici votre progression pour l'ann√©e scolaire <strong>{{ annee_scolaire }}</strong></p>
        </div>
        <div class="welcome-stats">
            <div class="stat-badge">
                <span class="stat-icon">üìÖ</span>
                <span class="stat-text">Syst√®me {{ systeme_scolaire }}</span>
            </div>
        </div>
    </div>

    <!-- Stats rapides -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon-bg" style="background: #dbeafe;">
                <span>üì•</span>
            </div>
            <div class="stat-info">
                <h3>{{ stats.total_downloads }}</h3>
                <p>T√©l√©chargements</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon-bg" style="background: #fef3c7;">
                <span>üìÖ</span>
            </div>
            <div class="stat-info">
                <h3>{{ stats.this_month }}</h3>
                <p>Ce mois</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon-bg" style="background: #d1fae5;">
                <span>üíæ</span>
            </div>
            <div class="stat-info">
                <h3>{{ downloads_remaining }}</h3>
                <p>Restants</p>
            </div>
        </div>
        
        <div class="stat-card premium">
            <div class="stat-icon-bg" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);">
                <span>üëë</span>
            </div>
            <div class="stat-info">
                <h3>{{ abonnement.get_plan_display }}</h3>
                <p>Abonnement</p>
            </div>
        </div>
    </div>

    <!-- Contenu principal -->
    <div class="dashboard-grid">
        
        <!-- Colonne gauche -->
        <div class="dashboard-main">
            
            <!-- Acc√®s rapide par p√©riode -->
            <div class="card">
                <div class="card-header">
                    <h3>üìö Acc√®s rapide par p√©riode</h3>
                    <span class="badge-semestre">{{ annee_scolaire }}</span>
                </div>
                
                <div class="periodes-grid">
                    {% for periode in periodes %}
                    <a href="{% url 'epreuves:liste' %}?periode={{ periode.id }}" class="periode-card">
                        <div class="periode-num">{{ periode.numero }}</div>
                        <div class="periode-info">
                            <h4>{{ periode.nom }}</h4>
                            <p>{{ periode.mois_debut }} - {{ periode.mois_fin }}</p>
                            <span class="periode-count">{{ periode.count }} √©preuves</span>
                        </div>
                    </a>
                    {% endfor %}
                    
                    <a href="{% url 'epreuves:liste' %}?type_epreuve=bepc" class="periode-card examen">
                        <div class="periode-num">üéì</div>
                        <div class="periode-info">
                            <h4>Examens Officiels</h4>
                            <p>BEPC, Bac, CEPED</p>
                            <span class="periode-count">Voir tout</span>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Derniers t√©l√©chargements -->
            <div class="card">
                <div class="card-header">
                    <h3>‚è±Ô∏è Derniers t√©l√©chargements</h3>
                    <a href="{% url 'dashboard:downloads' %}" class="btn-link">Voir tout</a>
                </div>
                
                {% if recent_downloads %}
                <div class="downloads-list">
                    {% for dl in recent_downloads %}
                    <div class="download-item">
                        <div class="dl-icon" style="background: {{ dl.epreuve.matiere.couleur }}20; color: {{ dl.epreuve.matiere.couleur }}">
                            {{ dl.epreuve.matiere.icon }}
                        </div>
                        <div class="dl-info">
                            <h4>{{ dl.epreuve.matiere.nom }}</h4>
                            <p>{{ dl.epreuve.get_type_epreuve_display }} ‚Ä¢ {{ dl.epreuve.classe.nom }}</p>
                            <span class="dl-date">{{ dl.date_telechargement|date:"d/m/Y" }}</span>
                        </div>
                        <a href="{{ dl.epreuve.get_absolute_url }}" class="btn-revoir">‚Üª</a>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-small">
                    <p>Aucun t√©l√©chargement encore</p>
                    <a href="{% url 'epreuves:liste' %}" class="btn-primary">Explorer les √©preuves</a>
                </div>
                {% endif %}
            </div>

        </div>

        <!-- Colonne droite -->
        <div class="dashboard-sidebar">
            
            <!-- Mon abonnement -->
            <div class="card">
                <div class="card-header">
                    <h3>üí≥ Mon abonnement</h3>
                </div>
                <div class="abonnement-info">
                    <div class="plan-badge plan-{{ abonnement.plan }}">
                        {{ abonnement.get_plan_display }}
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ usage_percentage }}%"></div>
                    </div>
                    
                    <p class="progress-text">
                        {{ abonnement.telechargements_utilises }} / {{ abonnement.telechargements_inclus }} t√©l√©chargements utilis√©s
                    </p>
                    
                    {% if abonnement.plan == 'gratuit' %}
                    <a href="{% url 'abonnements:plans' %}" class="btn-upgrade">
                        üöÄ Passer √† Premium
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- Mati√®res populaires -->
            <div class="card">
                <div class="card-header">
                    <h3>üî• Mati√®res populaires</h3>
                </div>
                <div class="matieres-list">
                    {% for matiere in matieres_populaires %}
                    <a href="{% url 'epreuves:liste' %}?matiere={{ matiere.id }}" class="matiere-item">
                        <span class="matiere-icon" style="background: {{ matiere.couleur }}20; color: {{ matiere.couleur }}">
                            {{ matiere.icon }}
                        </span>
                        <span class="matiere-nom">{{ matiere.nom }}</span>
                        <span class="matiere-count">{{ matiere.epreuves_count }}</span>
                    </a>
                    {% endfor %}
                </div>
            </div>

            <!-- Prochaines √©ch√©ances -->
            <div class="card">
                <div class="card-header">
                    <h3>üìÖ Calendrier scolaire</h3>
                </div>
                <div class="echeances-list">
                    <div class="echeance-item">
                        <span class="echeance-date">D√©c 2024</span>
                        <span class="echeance-label">Fin 1er Semestre</span>
                    </div>
                    <div class="echeance-item important">
                        <span class="echeance-date">Juin 2025</span>
                        <span class="echeance-label">üéì BEPC / Bac</span>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
}

/* Welcome */
.welcome-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.welcome-text h1 {
    font-size: 1.75rem;
    color: #1f2937;
    margin-bottom: 0.5rem;
}

.welcome-text p {
    color: #6b7280;
}

.stat-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

/* Stats grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.stat-card.premium {
    background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
    border: 1px solid #fef3c7;
}

.stat-icon-bg {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.stat-info h3 {
    font-size: 1.5rem;
    color: #1f2937;
    margin-bottom: 0.25rem;
}

.stat-info p {
    font-size: 0.875rem;
    color: #6b7280;
}

/* Dashboard grid */
.dashboard-grid {
    display: grid;
    grid-template-columns: 1fr 350px;
    gap: 1.5rem;
}

.card {
    background: white;
    border-radius: 20px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.25rem;
}

.card-header h3 {
    font-size: 1.1rem;
    color: #1f2937;
}

.badge-semestre {
    padding: 0.375rem 0.875rem;
    background: #f3f4f6;
    border-radius: 9999px;
    font-size: 0.875rem;
    color: #6b7280;
}

/* P√©riodes */
.periodes-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.periode-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem;
    background: #f9fafb;
    border-radius: 16px;
    text-decoration: none;
    transition: all 0.2s;
    border: 2px solid transparent;
}

.periode-card:hover {
    background: #f3f4f6;
    border-color: #6366f1;
    transform: translateY(-2px);
}

.periode-card.examen {
    background: linear-gradient(135deg, #fef3c7 0%, #fffbeb 100%);
    border-color: #fbbf24;
}

.periode-num {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    font-weight: 600;
}

.periode-card.examen .periode-num {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    font-size: 1.5rem;
}

.periode-info h4 {
    font-size: 1rem;
    color: #1f2937;
    margin-bottom: 0.25rem;
}

.periode-info p {
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 0.5rem;
}

.periode-count {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    background: white;
    border-radius: 6px;
    color: #6366f1;
    font-weight: 500;
}

/* Downloads list */
.downloads-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.download-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 12px;
}

.dl-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
}

.dl-info {
    flex: 1;
}

.dl-info h4 {
    font-size: 0.95rem;
    color: #1f2937;
    margin-bottom: 0.25rem;
}

.dl-info p {
    font-size: 0.8rem;
    color: #6b7280;
}

.dl-date {
    font-size: 0.75rem;
    color: #9ca3af;
}

.btn-revoir {
    width: 36px;
    height: 36px;
    background: white;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: #6366f1;
    border: 1px solid #e5e7eb;
}

/* Sidebar */
.abonnement-info {
    text-align: center;
}

.plan-badge {
    display: inline-block;
    padding: 0.5rem 1.5rem;
    border-radius: 9999px;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.plan-gratuit { background: #fef3c7; color: #92400e; }
.plan-mensuel { background: #dbeafe; color: #1e40af; }
.plan-annuel { background: #d1fae5; color: #065f46; }

.progress-bar {
    height: 8px;
    background: #f3f4f6;
    border-radius: 9999px;
    overflow: hidden;
    margin-bottom: 0.75rem;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 9999px;
    transition: width 0.3s;
}

.progress-text {
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 1.5rem;
}

.btn-upgrade {
    display: block;
    padding: 0.875rem;
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 500;
}

/* Mati√®res */
.matieres-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.matiere-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: 10px;
    text-decoration: none;
    transition: all 0.2s;
}

.matiere-item:hover {
    background: #f9fafb;
}

.matiere-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
}

.matiere-nom {
    flex: 1;
    color: #1f2937;
    font-size: 0.9rem;
}

.matiere-count {
    padding: 0.25rem 0.5rem;
    background: #f3f4f6;
    border-radius: 6px;
    font-size: 0.75rem;
    color: #6b7280;
}

/* √âch√©ances */
.echeances-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.echeance-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.875rem;
    background: #f9fafb;
    border-radius: 10px;
}

.echeance-item.important {
    background: #fef3c7;
}

.echeance-date {
    font-size: 0.875rem;
    font-weight: 500;
    color: #1f2937;
}

.echeance-label {
    font-size: 0.875rem;
    color: #6b7280;
}

/* Responsive */
@media (max-width: 1024px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .periodes-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 640px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}